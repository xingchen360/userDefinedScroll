<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>scroll</title>
		<link rel="stylesheet" type="text/css" href="css/reset.css"/>
		<script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.js" ></script>
		<style type="text/css">
			body{
				background: #ccc;
			}
			.scroll-demo{
				width:540px;
				border: 1px solid #e5e5e5;
				background: #fff;
				margin: 30px auto;
			}
			
			/**便签切换区*/
			.scroll-tab{
				height: 34px;
				border-bottom: 1px solid #E5E5E5;
				color: #666;
				background: #f8f8f8;
			}
			.scroll-tab .tab-item{
				float: left;
				font:14px/34px "microsoft yahei";
				height: 34px;text-align: center;
				border-right: 1px solid #E5E5E5;
				padding: 0 20px;
			}
			.scroll-tab .tab-active{
				color: #00be3c;
				background: #FFFFFF;
				border-top: 2px solid #00BE3C;
				margin: -1px 0;
			}
			
			/**滚动内容取*/
			.scroll-wrap{
				position: relative;
				width: 100%;
				height: 300px;
			}
			/**滚动内容*/
			.scroll-wrap .scroll-cont{
				height: 100%;
				padding: 0 15px;
				overflow: hidden;
			}
			.scroll-wrap .scroll-cont{
				font:14px/3 "microsoft yahei";
				margin-bottom: 10px;
				text-indent: 2em;
				line-height: 20px;
			}
			.scroll-wrap .scroll-cont .scroll-ol{
				padding-bottom: 1px;
				
			}
			.scroll-wrap .scroll-bar{
				position: absolute;
				top: 0;
				right: 0;
				width: 10px;
				height: 100%;
				background-color: #eaeaea;
			}
			/**滑块*/
			.scroll-wrap .scroll-slider{
				position: absolute;
				top: 0;
				left: 1px;
				width: 8px;
				height: 30px;
				background-color: #fff;
			}
		</style>
	</head>
	<body>
		<!--
        	作者：NoteShare
        	时间：2016-09-23
        	描述：自定义滚动条
        -->
		<div class="scroll-demo">
			<!--标签切换区-->
			<ul class="scroll-tab clearfix">
				<li class="tab-item tab-active">第一篇</li>
				<li class="tab-item">第二篇</li>
				<li class="tab-item">第三篇</li>
				<li class="tab-item">第四篇</li>
			</ul>
			<!--滚动内容区-->
			<div class="scroll-wrap">
				<!--滚动内容-->
				<div class="scroll-cont">
					<h5 class="anchor">第一篇</h5>
					<div class="scroll-ol">
						很多新人都很关心的问题，掌握了SEO技术能做什么？下面总结几种SEO赚钱的方式，刚开始做的新手可以先去网络公司打工，等有经验了和一定的人脉资源，可以开办一家网站优化工作室。
	
						掌握SEO技术盈利覆盖面较广，可以参考以下几点！
						
						1、提供搜索引擎排名服务赚钱：
						服务对象：中小企业网站
						适合对象：SEO新手
						收费模式：按照关键词收费
						
						2、利用SEO打造大流量网站：
						适合对象：SEO熟练者+网站制作高手
						赚钱模式：收取广告费
						
						3、利用SEO和传统贸易公司合作
						适合对象：有传统生意基础的SEO人员
						赚钱模式：销售产品
						
						4、SEO+CPA销售联盟
						适合对象：SEO人员，英文好的优先
						赚钱模式：赚取佣金
						
						5、SEO顾问服务：
						服务对象：大中型网站
						适合对象：经验丰富的SEO
						赚钱模式：按照时间收取顾问费、按照项目收入费用。
						
						6、给别的公司打工：
						服务对象：大型网站或者公司
						适合对象：不想创业的SEO人员
						赚钱模式：按月领取工资
						赚钱流程：听从公司安排做对应的工作。
						
						总结：掌握好SEO技术不仅能够通过优化企业网站接单赚钱，也可以优化行业网站采取合作的方式赚钱，SEO技术是一个能把任何产品都能够摆到用户面前的一个技术手段，掌握好SEO技术就能免费够获得更多潜在用户，最后实现盈利目的。
						很多新人都很关心的问题，掌握了SEO技术能做什么？下面总结几种SEO赚钱的方式，刚开始做的新手可以先去网络公司打工，等有经验了和一定的人脉资源，可以开办一家网站优化工作室。
	
						掌握SEO技术盈利覆盖面较广，可以参考以下几点！
						
						1、提供搜索引擎排名服务赚钱：
						服务对象：中小企业网站
						适合对象：SEO新手
						收费模式：按照关键词收费
						
						2、利用SEO打造大流量网站：
						适合对象：SEO熟练者+网站制作高手
						赚钱模式：收取广告费
					</div>
					<h5 class="anchor">第二篇</h5>
					<div class="scroll-ol">
						3、利用SEO和传统贸易公司合作
						适合对象：有传统生意基础的SEO人员
						赚钱模式：销售产品
						
						4、SEO+CPA销售联盟
						适合对象：SEO人员，英文好的优先
						赚钱模式：赚取佣金
						
						5、SEO顾问服务：
						服务对象：大中型网站
						适合对象：经验丰富的SEO
						赚钱模式：按照时间收取顾问费、按照项目收入费用。
					</div>
					<h5 class="anchor">第三篇</h5>
					<div class="scroll-ol">
						6、给别的公司打工：
						服务对象：大型网站或者公司
						适合对象：不想创业的SEO人员
						赚钱模式：按月领取工资
						赚钱流程：听从公司安排做对应的工作。
						6、给别的公司打工：
						服务对象：大型网站或者公司
						适合对象：不想创业的SEO人员
						赚钱模式：按月领取工资
						6、给别的公司打工：
						服务对象：大型网站或者公司
						适合对象：不想创业的SEO人员
						服务对象：大型网站或者公司
						适合对象：不想创业的SEO人员
						赚钱模式：按月领取工资
						赚钱流程：听从公司安排做对应的工作。
						6、给别的公司打工：
						服务对象：大型网站或者公司
						适合对象：不想创业的SEO人员
						赚钱模式：按月领取工资
						6、给别的公司打工：
						服务对象：大型网站或者公司
						适合对象：不想创业的SEO人员
						赚钱模式：按月领取工资
						赚钱流程：听从公司安排做对应的工作。						
						总结：掌握好SEO技术不仅能够通过优化企业网站接单赚钱，也可以优化行业网站采取合作的方式赚钱，SEO技术是一个能把任何产品都能够摆到用户面前的一个技术手段，掌握好SEO技术就能免费够获得更多潜在用户，最后实现盈利目的。
						
						掌握SEO技术盈利覆盖面较广，可以参考以下几点！
						
						1、提供搜索引擎排名服务赚钱：
						服务对象：中小企业网站
						适合对象：SEO新手
						收费模式：按照关键词收费
					</div>
					<h5 class="anchor">第四篇</h5>
					<div class="scroll-ol">
						2、利用SEO打造大流量网站：
						适合对象：SEO熟练者+网站制作高手
						赚钱模式：收取广告费
					</div>
					<!--内容高度补足-->
					<div class="correct-bot"></div>
				</div>
				<!--滚动条-->
				<div class="scroll-bar">
					<!--滚动滑块-->
					<div class="scroll-slider"></div>
				</div>
			</div>
		</div>
		<script type="text/javascript">
			"use strict";
			(function (win,doc,$){
				//构造函数
				function CusScrollBar(options){
					this._init(options);
				}
				/*把以下初始化方法重写为下面使用extend方法实现的方式
				 * CusScrollBar.prototype._init = function(){
					console.log("test");
				}*/
				$.extend(CusScrollBar.prototype, {
					_init:function(options){
						var self = this;
						self.options = {
							scrollDir			: "y", //滚动方向
							contSelector		: "",  //滚动内容区选择器
							barSelector			: "",  //滚动条选择器
							sliderSelector		: "",   //滚动滑块选择器
							tabItemSelector		: ".tab-item",  //标签选择器
							tabActiveClass		: "tab-active",  //选中标签类名
							anchorSelector		: ".anchor", //锚点选择器
							correctSelector		: ".correct-bot", //校正元素
							articleSelector		: ".scroll-ol", //文章选择器
							wheelStep			: 10  //滚轮步长
						}
						;
						$.extend(true,self.options,options || {});
						self._initDomEvent();
						return self;
					},
					/**
					 * 初始化DOM引用
					 */
					_initDomEvent : function(){
						var self = this;
						var opts = this.options;
						this.$cont = $(opts.contSelector);
						this.$slider = $(opts.sliderSelector);
						this.$bar = opts.barSelector ? $(opts.barSelector) : self.$slider.parent();
						//标签项
						this.$tabItem = $(opts.tabItemSelector);
						//锚点项
						this.$anchor = $(opts.anchorSelector);
						//正文
						this.$article = $(opts.articleSelector);
						//校正元素对象
						this.$corret = $(opts.correctSelector);
						//获取文档对象
						this.$doc = $(doc);
						this._initSliderDragEvent()._bindContScroll()._bindMousewheel()._initTabEvent()._initArticleHeight();
					},
					/**
					 * 初始化文档高度 
					 */
					_initArticleHeight : function(){
						var self = this,
						lastArticle = self.$article.last();
						var lastArticleHeight = lastArticle.height(),
						contHeight = self.$cont.height();
						if(lastArticleHeight < contHeight){
							//outHeight()包含padding-top和padding-bottom和border-top和border-bottom的高度。
							self.$corret[0].style.height = contHeight - lastArticleHeight - self.$anchor.outerHeight() + "px";
						}
						return self;
					},
					/**
					 * 初始化滑块拖动功能
					 */
					_initSliderDragEvent : function(){
						var self = this;
						var slider = this.$slider,
							sliderEl = slider[0];
						if(sliderEl){
							var doc = self.$doc,
								dragStartPagePosition,
								dragStartScrollPosition,
								dragContBarRate;
							function mousemoveHandler(e){
								e.preventDefault;
								if(dragStartPagePosition == null){
									return;
								}
								//console.log(dragStartScrollPosition);
								//console.log(e.pageY);
								//console.log(dragContBarRate);
								//console.log(dragStartScrollPosition + (e.pageY - dragStartPagePosition) * dragContBarRate);
								self.scrollTo(dragStartScrollPosition + (e.pageY - dragStartPagePosition) * dragContBarRate);
							}
							slider.on("mousedown",function(e){
								//因为事件的默认行为往往会导致一些不可预测的结果，所以我们通过preventDefault把事件的默认行为阻止掉。
								e.preventDefault();
								//鼠标当前位置
								dragStartPagePosition = e.pageY;
								//内容区滚动的距离
								dragStartScrollPosition = self.$cont[0].scrollTop;
								dragContBarRate = self.getMaxScrollPosition()/self.getMaxSliderPosition();
								doc.on("mousemove.scroll",mousemoveHandler)
								   .on("mouseup.scroll",function(){
									//解除事件绑定
									//console.log("mouseup");
									//这个会把document上的所有mousemove mouseup方法解除绑定，这必然会存在一定的风险。===为了解决这个风险我们给事件添加命名空间，
									//具体可以查看on和off的相关说明
									//doc.off("mousemove mouseup");
									//通过命名空间移出绑定的事件
									doc.off(".scroll");
								});
							});
						}
						return self;
					},
					/**
					 * 初始化标签切换功能 
					 */
					_initTabEvent : function(){
						var self = this;
						self.$tabItem.on("click",function(e){
							e.preventDefault();
							var index = $(this).index();
							self.changeTabSelect(index);
							//已经滚出可视区的内容高度
							//+指定锚点与内容容器的距离
							self.scrollTo(self.$cont[0].scrollTop + self.getAnchorPosition(index));
						});
						return self;
					},
					//切换标签的选中
					changeTabSelect : function(index){
						var self = this,
						active = self.options.tabActiveClass;
						return self.$tabItem.eq(index).addClass(active).siblings().removeClass(active);
					},
					//获取指定锚点到上边界的像素值
					//position() 获取匹配元素中第一个元素的当前位置，相对于离该元素最近且被定位过的父元素（relative，absolute，fixed）
					//position(coordinates)设置匹配的元素集合中每一个元素的坐标，坐标相对于文档如：{x：10，y：20}
					getAnchorPosition : function(index){
						return this.$anchor.eq(index).position().top;
					},
					//获取每个锚点位置信息的数组
					getAllAnchorPostion : function(){
						var self = this,
						allPositionArr = [];
						for(var i =0;i < self.$anchor.length; i++){
							allPositionArr.push(self.$cont[0].scrollTop + self.getAnchorPosition(i));
						}
						return allPositionArr;
					},
					//监听内容的滚动，同步滑块的位置
					_bindContScroll : function(){
						var self = this;
						self.$cont.on("scroll",function(){
							var sliderEl = self.$slider && self.$slider[0];
							if(sliderEl){
								sliderEl.style.top = self.getSliderPosition() + "px";
							}
						});
						return self;
					},
					_bindMousewheel : function(){
						var self = this;
						self.$cont.on("mousewheel DOMMouseScroll",function(e){
							e.preventDefault();
							var oEv = e.originalEvent,
							wheelRange = oEv.wheelDelta ? -oEv.wheelDelta/120 : (oEv.detail || 0)/3;
							self.scrollTo(self.$cont[0].scrollTop + wheelRange * self.options.wheelStep);
						});
						return self;
					},
					//计算滑块的当前位置
					getSliderPosition : function(){
						var self = this,
						maxSliderPosition = self.getMaxSliderPosition();
						return Math.min(maxSliderPosition,maxSliderPosition * self.$cont[0].scrollTop/self.getMaxScrollPosition());
					},
					//内容可滚动的高度
					getMaxScrollPosition : function(){
						var self = this;
						//self.$cont[0].scrollHeight内容的整体高度
						//$cont.height()文档可视区的高度
						//console.log(self.$cont.height());
						//console.log(self.$cont[0].scrollHeight);
						//以下求max是为了解决的内容的整体高度小于可视区时，取最大的值作为内容的整体高度
						//这里有点没弄明白，当内容的整体高度小于可视区时，测试的结果self.$cont.height()和self.$cont[0].scrollHeight相同均为可视区高度
						return Math.max(self.$cont.height(),self.$cont[0].scrollHeight) - self.$cont.height();
					},
					//滑块可移动的距离
					getMaxSliderPosition : function(){
						var self = this;
						return self.$bar.height() - self.$slider.height();
					},
					scrollTo : function(positionVal){
						var self = this;
						var posArr = self.getAllAnchorPostion();
						//滚动条的位置与tab标签的对应
						function getIndex(positionVal){
							for(var i = posArr.length -1;i >= 0; i--){
								if(positionVal >= posArr[i]){
									return i;
								}else{
									continue;
								}
							};
						}
						//锚点数与标签数相同
						if(posArr.length == self.$tabItem.length){
							self.changeTabSelect(getIndex(positionVal));
						}
						self.$cont.scrollTop(positionVal);
					}
				});
				win.CusScrollBar = CusScrollBar;
			})(window,document,jQuery);
			
			//测试代码
			var temp = new CusScrollBar({
				contSelector		: ".scroll-cont",  //滚动内容区选择器
				barSelector			: ".scroll-bar",  //滚动条选择器
				sliderSelector		: ".scroll-slider",   //滚动滑块选择器
				wheelStep  			: 10 //滚轮步长
			});
		</script>
	</body>
</html>
